#:kivy 1.8.0
#:import Factory kivy.factory.Factory
#:import screenmanager kivy.uix.screenmanager
#:import p parameters
# note that this requires the kgui folder to be in PYTHONPATH or sys.path, unless the 
# interpreter is started in this folder because the import is happening in kivy/lang/parser.py 

FloatLayout:
    StatusBar:
        height: p.status_bar_height
        size_hint: 1, None
        top: root.top
    MainTabs:
        id: tabs
        height: root.height - p.status_bar_height
        size_hint_y: None

<StatusBar@BoxLayout>:
    orientation: 'horizontal'
    StackLayout:
        id: left
        orientation: 'lr-tb'
        width: self.minimum_width
        x: root.x
        Label:
            id: state
            text: "state: " + app.state
            color: p.status_color
            size_hint_x: None
            size: self.texture_size
            font_size: root.height - 5
            padding: 7, 0
    StackLayout:
        id: right
        orientation: 'rl-tb'
        width: self.minimum_width
        right: root.right
        ConnectionIcon:
            id: con
            size_hint: None, None
            size: 0, root.height
            topright: root.right, root.top
        TimeLabel:
            color: p.status_color
            id: time
            text: self.time
            size_hint_x: None
            size: self.texture_size
            font_size: root.height - 4
            padding: 7, 0

<MainTabs@TabbedPanel>:
    tab_pos: 'bottom_mid'
    tab_width: p.screen_width/3
    tab_height: p.tab_height
    do_default_tab: False
    HomeTab:
        id: home_tab
    FileTab:
        id: file_tab
    SettingTab:
        id: set_tab

# HOME ########################################################################

<HomeTab@TabbedPanelItem>:
    background_down: '' # dadurch nimmt es background color an, sowieso immer mit dessen opacity auch waere es ein bild
    background_normal: ''
    background_color: (0,0,0,0)
    canvas:
        Color:
            rgba: p.background if self.state == 'down' else (0,0,0,0)
        RoundedRectangle:
            radius: (0, 0, p.popup_radius, p.popup_radius)
            size: p.screen_width/3, p.tab_height
            pos: 0,0
        Rectangle:
            size: p.tab_height/2, p.tab_height/2
            pos: p.screen_width/3, p.tab_height/2
        Color:
            rgba: (0,0,0,1) if self.state == 'down' else (0,0,0,0)
        RoundedRectangle:
            size: p.tab_height/2, p.tab_height/2
            pos: p.screen_width/3, p.tab_height/2
            radius: (p.popup_radius, 0, 0, 0)
        Color:
            rgba: (1,1,1,1) if self.state == 'down' else p.status_color
        Rectangle:
            source: p.kgui_dir+'/Logos/HomeIcon.png'
            size: 100, 100
            pos: 50, 0
    FloatLayout:
        Widget:
            pos_hint: {'x':0,'y':0}
            size_hint: 1,1
            canvas:
                Color:
                    rgba: p.background
                RoundedRectangle:
                    radius: (p.popup_radius, p.popup_radius, p.popup_radius, 0)
                    size: self.size
                    pos: self.pos
        ProgressBar:
            enabled: True if app.state == 'printing' or app.state == 'paused' or app.state == 'pausing' else False
            id: progress_bar
            max: 1
            value: app.progress
            size_hint: None, None
            size: p.screen_width-2*p.h_padding+2, p.progress_bar_height
            pos: p.h_padding-1, p.tab_height + p.padding
        Label:
            text: app.print_time if app.state == 'printing' or app.state == 'paused' or app.state == 'pausing' else ""
            size_hint: None, None
            size: p.screen_width-2*p.padding, p.normal_font
            text_size: self.size
            font_size: p.normal_font
            x: p.h_padding - 2
            top: progress_bar.y - 8
            halign: 'left'
            valign: 'bottom'
        Btn_Stop:
            on_release: app.send_stop()
            id: btn_stop
            size: 118,118
            center_y: progress_bar.top + p.padding + p.btn_height/2
            center_x: p.screen_width - p.btn_height/2 - p.h_padding
        Btn_Play:
            on_release:
                if self.paused: app.send_play(); self.paused=False;
                else:           app.send_pause(); self.paused=True;
            size: btn_stop.size
            y: btn_stop.y
            right: btn_stop.x
        Label:
            id: l_filename
            text: app.print_title if app.state == 'printing' or app.state == 'paused' or app.state == 'pausing' else ""
            size_hint: None, None
            size: 280,134
            text_size: self.size
            font_size: p.large_font
            x: p.h_padding-3
            center_y: btn_stop.center_y
            shorten: True
            halign: 'left'
            valign: 'middle'
        ScreenManager:
            current: 'printingscreen' if app.state == 'printing' else 'homescreen'
            transition: screenmanager.NoTransition()
            id: hs_manager
            size_hint: None, None
            size: p.screen_width, p.screen_height-btn_stop.center_y-p.btn_height/2
            pos: root.x, btn_stop.center_y+p.btn_height/2
            HomeScreen:
            PrintingScreen:
        Btn_Temp:
            id: temp_T1
            heater_id: "T1"
            on_release: Factory.ExtTempPopup(creator=self, val=app.temp).open()
            large_value: "{:3.0f}°C".format(app.temp[self.heater_id][1])
            small_value: "{:3.0f}".format(app.temp[self.heater_id][0]) if app.temp[self.heater_id][0] != 0 else "Off"
            red: app.temp[self.heater_id][1] > 50
            width: 130
            right: temp_bed.right if app.extruder_count > 1 else p.mars
            center_y: p.tab_height + p.padding*2 + p.progress_bar_height + p.btn_height/2 + p.btn_spacing
        Btn_Extruder:
            heater_id: 'T1'
            x: p.h_padding if app.extruder_count > 1 else p.mars
            y: p.tab_height + p.padding*2 + p.progress_bar_height + p.btn_spacing
        Btn_Temp:
            id: temp_T0
            heater_id: "T0"
            on_release: Factory.ExtTempPopup(creator=self, val=app.temp).open()
            large_value: "{:3.0f}°C".format(app.temp[self.heater_id][1])
            small_value: "{:3.0f}".format(app.temp[self.heater_id][0]) if app.temp[self.heater_id][0] != 0 else "Off"
            red: app.temp[self.heater_id][1] > 50
            width: 130
            right: temp_bed.right
            center_y: p.tab_height + p.progress_bar_height + 4*p.padding + 2.5*p.btn_height
        Btn_Extruder:
            heater_id: 'T0'
            x: p.h_padding
            y: p.tab_height + p.padding*2 + p.progress_bar_height + 2*p.btn_spacing
        Btn_Temp:
            on_release: Factory.BedTempPopup(creator=self, val=app.temp).open()
            id: temp_bed
            large_value: "{:3.0f}°C".format(app.temp['B'][1])
            small_value: "{:3.0f}".format(app.temp['B'][0]) if app.temp['B'][0] != 0 else "Off"
            red: app.temp['B'][1] > 50
            x: p.h_padding
            center_y: p.tab_height + p.progress_bar_height + 5*p.padding + 3.5*p.btn_height
            canvas.before:
                Color:
                    rgba: p.nozzle
                #:set bw 80
                #:set bx1 -20
                #:set bx2 +20
                #:set bh 42
                #:set bo 16
                #:set icon_center 27
                Line:
                    width: p.icon_radius
                    points: self.x + icon_center - bw/2, self.center_y - p.btn_height/2 + p.icon_radius,   self.x + icon_center + bw/2, self.center_y - p.btn_height/2 + p.icon_radius

                Line:
                    width: p.icon_radius - 0.5
                    bezier: self.x + icon_center + bx1, self.center_y + p.btn_height/2 - p.icon_radius,   self.x + icon_center + bx1 - bo, self.center_y + p.btn_height/2 - bh*0.35 - p.icon_radius,   self.x + icon_center + bx1 + bo, self.center_y + p.btn_height/2 - bh*0.65 - p.icon_radius,   self.x + icon_center + bx1, self.center_y + p.btn_height/2 - bh - p.icon_radius
                Line:
                    width: p.icon_radius - 0.5
                    bezier: self.x + icon_center + bx2, self.center_y + p.btn_height/2 - p.icon_radius,   self.x + icon_center + bx2 - bo, self.center_y + p.btn_height/2 - bh*0.35 - p.icon_radius,   self.x + icon_center + bx2 + bo, self.center_y + p.btn_height/2 - bh*0.65 - p.icon_radius,   self.x + icon_center + bx2, self.center_y + p.btn_height/2 - bh - p.icon_radius
                Line:
                    width: p.icon_radius - 0.5
                    bezier: self.x + icon_center, self.center_y + p.btn_height/2 - p.icon_radius,   self.x + icon_center - bo, self.center_y + p.btn_height/2 - bh*0.35 - p.icon_radius,   self.x + icon_center  + bo, self.center_y + p.btn_height/2 - bh*0.65 - p.icon_radius,   self.x + icon_center, self.center_y + p.btn_height/2 - bh - p.icon_radius


<Btn_Extruder@BaseButton>:
    #:set esh 17
    size: icon_center*2, p.btn_height
    heater_id: 'T0'
    selected: False
    canvas:
        Color:
            rgba: p.nozzle_selected if self.selected else p.nozzle
        Rectangle:
            size: self.width - 2*p.icon_radius, self.height - esh - p.icon_radius
            pos: self.x + p.icon_radius, self.y + esh
        Triangle:
            points: self.x + p.icon_radius, self.y + esh,   self.center_x, self.y,   self.right - p.icon_radius, self.y + esh
        Line:
            width: p.icon_radius
            points: self.x + p.icon_radius, self.y + esh,   self.center_x, self.y,   self.right - p.icon_radius, self.y + esh,   self.right - p.icon_radius, self.top - p.icon_radius,   self.x + p.icon_radius, self.top - p.icon_radius
            close: True
    Label:
        text: root.heater_id
        bold: True
        color: p.background
        center_x: root.center_x
        center_y: root.center_y + 2      
        font_size: p.large_font

<PrintingScreen@Screen>:
    name: "printingscreen"
    FloatLayout:

        Btn_Temp:
            id: fan
            on_release: Factory.FanPopup(val=app.fan_speed).open()
            large_value: "{:3.0f}%".format(app.fan_speed)
            small_value: "Print Cooling"
            right: p.screen_width - p.h_padding + 25
            center_y: p.padding + p.btn_height/2 + p.btn_spacing
        Btn_Temp:
            id: z_adjust
            on_release: Factory.ZAdjustPopup(val=app.z_adjust).open()
            large_value: "{:3.2f}mm".format(app.z_adjust)
            small_value: "Z Calibration"
            right: p.screen_width - p.h_padding + 25
            center_y: fan.center_y + p.btn_spacing
        Btn_Temp:
            id: pressure_advance
            on_release: Factory.PressureAdvancePopup(val=app.pressure_advance).open()
            large_value: "{:4.3f}s".format(app.pressure_advance)
            small_value: "Pressure Advance"
            right: p.screen_width - p.h_padding + 25
            center_y: z_adjust.center_y + p.btn_spacing
        Btn_Temp:
            id: acceleration
            on_release: Factory.AccPopup(write=False, val=app.acceleration).open()
            large_value: "{:5.0f}mm/s²".format(app.acceleration)
            small_value: "Acceleration"
            right: p.screen_width - p.h_padding + 25
            center_y: pressure_advance.center_y + p.btn_spacing
        Btn_Temp:
            id: speed
            on_release: Factory.SpeedPopup(val=app.speed).open()
            large_value: "{:3.0f}%".format(app.speed)
            small_value: "Print Speed"
            x: p.padding
            center_y: acceleration.center_y
        Btn_Temp:
            id: flow
            on_release: Factory.FlowPopup(val=app.flow).open()
            large_value: "{:3.0f}%".format(app.flow)
            small_value: "Material Flow"
            x: p.padding
            center_y: pressure_advance.center_y

<HomeScreen@Screen>:
    name: "homescreen"
    FloatLayout:
        Btn_Arrow:
            dir_right: True
            id: btn_right_T1
            y: p.padding if app.extruder_count > 1 else p.mars
            x: p.screen_width - p.h_padding
        Btn_Arrow:
            dir_right: True
            id: btn_right_T0
            y: 2*p.padding+p.btn_height
            x: btn_right_T1.x
        Btn_Triple:
            id: btn_tr_T1
            y: btn_right_T1.y if app.extruder_count > 1 else p.mars
            right: p.screen_width - p.h_padding
        Btn_Triple:
            id: btn_tr_T0
            y: btn_right_T0.y
            right: p.screen_width - p.h_padding
        Btn_Arrow:
            id: btn_left_T1
            y: btn_right_T1.y if app.extruder_count > 1 else p.mars
            right: btn_tr_T1.x
        Btn_Arrow:
            id: btn_left_T0
            y: btn_tr_T0.y
            right: btn_tr_T0.x
        Btn_Outline:
            id: btn_calibrate
            on_release: app.send_calibrate()
            enabled: app.printer_objects_available
            title: "Mesh Bed Leveling"
            size: btn_tr_T1.size
            pos: btn_tr_T0.x, 3*p.padding+2*p.btn_height
        Btn_TripleZ:
            id: btn_tr_Z
            height: xy_field.height
            h1: self.height/3
            h2: self.height/3
            h3: self.height/3
            width: p.btn_height*p.disp_vertical_stretch
            right: root.right- p.h_padding
            top: root.height-p.padding-p.status_bar_height
        XyField:
            id: xy_field
            size_hint: None, None
            height: p.btn_width
            width: self.height + 40
            x: p.h_padding
            top: root.height-p.padding-p.status_bar_height
            enabled: app.printer_objects_available and app.homed['x'] and app.homed['y']
        HomeButton:
            axis_id: 'Y'
            size: p.btn_height, p.btn_height
            pos: xy_field.right, xy_field.y
        HomeButton:
            axis_id: 'X'
            size: p.btn_height, p.btn_height
            pos: xy_field.right, xy_field.y + p.btn_height


# BUTTONS  ########################################################################

<BaseButton>:
    title: ''
    size_hint: None, None
    Label:
        text: root.title
        size: root.size
        color: (1,1,1,1) if root.enabled else p.button_disabled
        text_size: self.size
        pos: root.pos        
        font_size: p.normal_font
        valign: 'middle'
        halign: 'center'

<RoundButton@BaseButton>:
    canvas.after:
        Color:
            rgba: p.translucent_white if self.pressed and self.enabled else (0,0,0,0)
        RoundedRectangle:
            radius: (p.radius,)
            size: self.size
            pos: self.pos

<RectangleButton>:
    canvas:
        Color:
            rgba: p.translucent_white if self.pressed and self.enabled else (0,0,0,0)
        Rectangle:
            size: self.size
            pos: self.pos

<Btn_Stop@RoundButton>:
    enabled: True if app.state == 'printing' or app.state == 'paused' or app.state == 'pausing' else False
    canvas.before:
        Color:
            rgba: p.red if self.enabled else (0,0,0,0)
        RoundedRectangle:
            pos: self.center_x-p.btn_height/2,self.center_y-p.btn_height/2
            size: p.btn_height,p.btn_height
            radius: (p.icon_radius,)

<Btn_Play@RoundButton>:
    #:set h p.btn_height*1.155
    paused: False if app.state == 'printing' else True
    enabled: True if app.state == 'printing' or app.state == 'paused' or app.state == 'pausing' else False
    canvas.before:
        Color:
            rgba: 1,1,1,1 if self.enabled and not self.paused else 0
        RoundedRectangle:
            pos: self.center_x-p.btn_height/2, self.center_y-p.btn_height/2
            size: 0.39*p.btn_height,p.btn_height
            radius: (p.icon_radius,)
        RoundedRectangle:
            pos: self.center_x+p.btn_height/2-0.4*p.btn_height, self.center_y-p.btn_height/2
            size: 0.39*p.btn_height,p.btn_height
            radius: (p.icon_radius,)
    canvas:
        Color:
            rgba: 1,1,1,1 if self.enabled and self.paused else 0
        Triangle:
            points: self.center_x-p.btn_height/2, self.center_y- h/2,   self.center_x-p.btn_height/2, self.center_y+ h/2,   self.center_x+p.btn_height/2, self.center_y
        Line:
            width: p.icon_radius
            points: self.center_x-p.btn_height/2, self.center_y- h/2,   self.center_x-p.btn_height/2, self.center_y+ h/2,   self.center_x+p.btn_height/2, self.center_y
            close: True

<Btn@RoundButton>:
    title: ''
    canvas:
        Color:
            rgba: p.button
        RoundedRectangle:
            radius: (p.radius,)
            pos: self.pos
            size: self.size

<Btn_Outline@RoundButton>:
    title: ''
    canvas.before:
        Color:
            rgba: p.button_outline
        Line:
            rounded_rectangle: (self.x, self.y, self.width, self.height, p.radius)
            width: 1

<Btn_Arrow@RoundButton>:
    #:set v 44
    #:set w 22
    size: p.btn_height-22, p.btn_height
    dir_right: False
    canvas.before:
        Color:
            rgba: p.button_outline
        Line:
            points: (self.x+self.width/2-w/2, self.center_y- v/2, self.x+self.width/2-w/2, self.center_y+ v/2, self.x+self.width/2+w/2, self.center_y) if self.dir_right else (self.x+self.width/2+w/2, self.center_y- v/2, self.x+self.width/2+w/2, self.center_y+ v/2, self.x+self.width/2-w/2, self.center_y)
            close: True
            width: 1

<Btn_Triple@Widget>:
    filament_color: (0,0,0)
    filament_amount: 0
    title1: 'Unload'
    title2: ''
    title3: 'Load'
    width: p.btn_width
    w1: 78
    w2: 78
    w3: 78
    size_hint: None, None
    size: self.w1+self.w2+self.w3, p.btn_height
    canvas:
        Color:
            rgb: root.filament_color
        RoundedRectangle:
            size: root.size
            pos: root.pos
            radius: (p.radius,)
        Color:
            rgba: p.background
        Rectangle:
            size: root.width * (1-root.filament_amount), root.height
            pos: root.x + root.filament_amount * root.width, root.y
        Color:
            rgba: p.button_outline
        Line:
            width: 1
            rounded_rectangle: (self.x, self.y, self.width, self.height, p.radius)
        Rectangle:
            pos: self.x+self.w1, self.y+6
            size: 1, self.height-12
        Rectangle:
            pos: self.x+self.w1+1+self.w2, self.y+6
            size: 1, self.height-12
    BaseButton:
        size: root.w1, root.height
        pos: root.pos
        title: root.title1
        enabled: app.printer_objects_available
        canvas:
            Color:
                rgba: p.translucent_white if self.pressed else (0,0,0,0)
            RoundedRectangle:
                radius: (p.radius, 0,0,p.radius)
                size: self.size
                pos: self.pos
    BaseButton:
        size: root.w2, root.height
        pos: root.x + root.w1,root.y
        title: root.title2
        enabled: True
        on_release: app.notify.show("this is a ", "test hpwoo jkofdsoiajfdospajfiodpsjkj jk", level="info")

        canvas:
            Color:
                rgba: p.translucent_white if self.pressed else (0,0,0,0)
            Rectangle:
                size: self.size
                pos: self.pos
    BaseButton:
        size: root.w3, root.height
        pos: root.x + root.w1+root.w2,root.y
        title: root.title3
        enabled: app.printer_objects_available
        canvas:
            Color:
                rgba: p.translucent_white if self.pressed else (0,0,0,0)
            RoundedRectangle:
                radius: (0,p.radius,p.radius,0)
                size: self.size
                pos: self.pos

<Btn_TripleZ@Widget>:
    h1: 0
    h2: 0
    h3: 0
    size_hint: None, None
    canvas:
        Color:
            rgba: p.button_outline
        Line:
            rounded_rectangle: (self.x, self.y, self.width, self.height, p.radius)
        Rectangle:
            pos: self.x+6, self.y+self.h1
            size: self.width-12,1
        Rectangle:
            pos: self.x+6, self.y+self.h1+self.h2
            size: self.width-12,1
    #:set t 11
    #:set u 22 #Triangle has this size x2
    BaseButton:
        on_press: app.send_z_up() if p.invert_z_controls else app.send_z_down()
        on_release: app.send_z_stop()
        enabled: app.homed['z']
        size: root.width, root.h1
        pos: root.x, root.y
        canvas.before:
            Color:
                rgba: p.translucent_white if self.pressed else (0,0,0,0)
            RoundedRectangle:
                radius: (0,0,p.radius,p.radius)
                size: self.size
                pos: self.pos
            Color:
                rgba: (1,1,1,1) if self.enabled else p.button_disabled
            Triangle:
                points: self.center_x-u,self.center_y+t,   self.center_x+u,self.center_y+t,   self.center_x,self.center_y-t
    HomeButton:
        axis_id: 'Z'
        size: root.width, root.h2
        pos: root.x, root.h1 + root.y
        canvas.after:
            Clear
            Color:
                rgba: p.translucent_white if self.pressed else (0,0,0,0)
            Rectangle:
                size: self.size
                pos: self.pos
    BaseButton:
        on_press: app.send_z_down() if p.invert_z_controls else app.send_z_up()
        on_release: app.send_z_stop()
        enabled: app.homed['z']
        size: root.width, root.h3
        pos: root.x, root.top-root.h3
        canvas.before:
            Color:
                rgba: p.translucent_white if self.pressed else (0,0,0,0)
            RoundedRectangle:
                radius: (p.radius,p.radius,0,0)
                size: self.size
                pos: self.pos
            Color:
                rgba: (1,1,1,1) if self.enabled else p.button_disabled
            Triangle:
                points: self.center_x-u,self.center_y-t,   self.center_x+u,self.center_y-t,   self.center_x,self.center_y+t

<HomeButton@RoundButton>:
    axis_id: 'Z'
    on_release: app.send_home(self.axis_id)
    enabled: app.printer_objects_available
    canvas:
        Color:
            rgba: (1,1,1,1) if self.enabled else p.button_disabled
        Rectangle:
            source: p.kgui_dir+'/Logos/HomeAxisIcon.png'
            size: 64, 64
            pos: self.center_x-32, self.center_y-32
        Color:
            rgba: p.translucent_white if self.pressed else (0,0,0,0)
        Rectangle:
            size: self.size
            pos: self.pos
    Label:
        pos: root.x, root.y-2
        text: root.axis_id
        color: p.background
        font_size: p.normal_font
        bold: True
        size: root.size
        text_size: self.size
        center_x: root.center_x
        center_y: root.center_y
        halign: 'center'
        valign: 'middle'

<Btn_Temp@RoundButton>:
    red: False
    large_value: "-"
    small_value: "-"
    size: 190, 100
    Label:
        color: p.red if root.red else (1,1,1,1)
        text: root.large_value
        size_hint: None, None
        size: root.width, p.btn_height+13#to compensate for the font being 6px below top when set to 'top'
        text_size: self.size
        center_y: root.center_y
        right: root.right - 25
        font_size: p.large_font
        valign: 'top'
        halign: 'right'
    Label:
        color: p.medium_light_gray
        text: root.small_value
        size_hint: None, None
        size: root.width, p.btn_height+9
        text_size: self.size
        center_y: root.center_y
        right: root.right - 25
        font_size: p.normal_font
        valign: 'bottom'
        halign: 'right'

<Btn_P_Cancel@BaseButton>:
    title: "Cancel"
    single: False
    height: 70
    canvas:
        Color:
            rgba: p.divider
        Line:
            points: self.x, self.top, self.right, self.top
        Color:# Highlight pressed button
            rgba: p.translucent_white if self.pressed else (0,0,0,0)    
        RoundedRectangle:
            radius:(0,0,p.radius,p.popup_radius) if self.single else (0,0,0, p.popup_radius)
            pos: self.pos
            size: self.size

<Btn_P_Confirm@BaseButton>:
    title: "Confirm"
    height: 70
    enabled: False
    canvas:
        Color:
            rgba: p.divider
        Line:
            points: self.x, self.y, self.x, self.top, self.right, self.top
        Color:# Highlight pressed button
            rgba: p.translucent_white if self.pressed else (0,0,0,0)    
        RoundedRectangle:
            radius: (0,0,p.radius,0)
            pos: self.pos
            size: self.size

<Btn_Slider>:
    #:set t 9  #half of width
    #:set j 15
    x: self.px-self.width/2-self.offset
    size: 68,60
    size_hint: None,None 
    active: False
    canvas:
        Color:
            rgba: p.medium_light_gray if self.active else p.medium_gray
        RoundedRectangle:
            radius: (p.radius,)
            size: self.size
            pos: self.pos
        Triangle:
            points: [self.x+self.width/2+self.offset,self.top+j,   self.x+self.width/2+t+self.offset,self.top,    self.x+self.width/2-t+self.offset,self.top] if 2*abs(self.offset)!=self.width else [self.x+self.width/2+self.offset,self.top+j, self.x+self.width/2+self.offset,self.top-10, self.x+self.width/2+self.offset-(self.offset/abs(self.offset))*j,self.top]
    Label:
        markup: True
        text: root.s_title
        size: root.size
        text_size: self.size
        pos: root.pos        
        font_size: p.extra_small_font
        valign: 'middle'
        halign: 'center'

<UltraSlider>:
    #:set slider_pos_y 95
    size_hint: None,None
    size: p.screen_width - 2*p.small_padding - 2*p.padding, 200
    px: self.x + p.padding
    canvas:
        Color:
            rgba: (1,1,1,1) if root.pressed else p.button
        RoundedRectangle:
            radius: (4,)
            size: root.width-2*p.padding, 8
            pos: root.x+p.padding, slider_pos_y-4+root.y
        Color:
            rgba: (0, 0, 0, 0) if root.pressed else p.medium_light_gray
        RoundedRectangle:
            radius: (4,4,4,4)
            size: self.px - p.padding - self.x + 1, 8
            pos: root.x+p.padding, slider_pos_y-4+root.y
        Color:
            rgba: (0,0,0,0) if root.pressed  else (1,1,1,1) 
        Ellipse:
            size: 20,20
            pos: root.px-10,slider_pos_y-10+root.y
    Label:
        id: value_label
        text: root.disp
        max_lines: 1
        size_hint: None,None
        pos_hint: None,None
        size: root.width, p.large_font
        font_size: p.large_font
        y: root.y + 120
        center_x: root.center_x
        color: p.light_gray
        valign: 'middle'
        halign: 'center'

# Not used, this is for when klipper supports temperature offset
# <UltraOffsetSlider>:
#     offset: 0
#     RoundButton:
#         id: btn_plus
#         on_release: self.offset += 2.5
#         size: 62, 62
#         right: root.right-p.padding
#         y: root.y + 120
#         canvas:
#             Color:
#                 rgba: 1,1,1,1
#             Rectangle:
#                 size: 34, 5
#                 pos: self.center_x - 34/2, self.center_y - 5/2
#             Rectangle:
#                 size: 5, 34
#                 pos: self.center_x - 5/2, self.center_y - 34/2
#     RoundButton:
#         id: btn_minus
#         on_release: self.offset -= 2.5
#         size: 62, 62
#         right: btn_plus.x
#         y: btn_plus.y
#         canvas:
#             Color:
#                 rgba: 1,1,1,1
#             Rectangle:
#                 size: 34, 5
#                 pos: self.center_x - 34/2, self.center_y - 5/2
#     RoundButton:
#         on_release: self.offset = 0
#         size: 62, 62
#         right: btn_minus.x
#         y: btn_plus.y
#         canvas:
#             Color:
#                 rgba: (0,0,0,0) if root.offset == 0 else (1,1,1,1)
#             Line:
#                 width: 2.6
#                 circle: (self.center_x, self.center_y, 15, 0, 270)
#             Triangle:
#                 points: (self.center_x - 8, self.center_y + 15, self.center_x, self.center_y + 15 + 8, self.center_x, self.center_y + 15 - 8)
                
<BasePopup>:
    title_size: p.large_font
    title_align: 'center'
    background_color: (0.03,0.03,0.03,0.56) #reduces background darkening from 0.7
    size_hint: 0.67, 0.3
    pos_hint: {'center_y': 0.55, 'center_x':0.5}

<ZAdjustPopup@BasePopup>:
    size_hint: 0.95,0.4
    title: "Calibrate Z Height"
    FloatLayout:
        UltraSlider:
            val: root.val
            buttons: [[0,0,"default", None]]
            val_min: -0.5
            val_max: 0.5
            unit: "mm"
            roundto: 2
            id: slider
            width: root.width
            pos_hint: {'center_x':0.5, 'y':0.35}
        Btn_P_Cancel:
            id: btn_cancel
            width: root.width/2
            pos: root.pos
            on_release: root.dismiss()
        Btn_P_Confirm:
            enabled: slider.changed
            width: root.width/2
            pos: root.center_x, root.y
            on_release: app.send_z_adjust(slider.val), root.dismiss()

<PressureAdvancePopup@BasePopup>:
    size_hint: 0.95, 0.4
    write: False
    title: "Write Pressure Advance to Config" if self.write else "Set Pressure Advance"
    FloatLayout:
        UltraSlider:
            val: root.val
            buttons: []
            val_min: 0
            val_max: 0.05
            unit: "mm/mm/s"
            roundto: 3
            id: slider
            width: root.width
            pos_hint: {'center_x':0.5, 'y':0.35}
        Btn_P_Cancel:
            id: btn_cancel
            width: root.width/2
            pos: root.pos
            on_release: root.dismiss()
        Btn_P_Confirm:
            enabled: slider.changed
            width: root.width/2
            pos: root.center_x, root.y
            on_release: 
                if root.write: app.write_pressure_advance(slider.val), root.dismiss()
                else: app.send_pressure_advance(slider.val), root.dismiss()

<AccPopup@BasePopup>:
    write: False
    title: "Write Acceleration to Config" if self.write else "Set Acceleration"
    size_hint: 0.83,0.4
    FloatLayout:
        UltraSlider:
            val: root.val
            val_min: 2000
            val_max: 50000
            unit: "mm/s²"
            roundto: -2
            buttons: [[36000,0,"default",None],]
            id: slider
            width: root.width
            pos_hint: {'center_x':0.5}
            y: btn_cancel.top+40
        Btn_P_Cancel:
            id: btn_cancel
            width: root.width/2
            pos: root.pos
            on_release: root.dismiss()
        Btn_P_Confirm:
            enabled: slider.changed
            width: root.width/2
            pos: root.center_x, root.y
            on_release:
                if root.write: (app.write_config('printer', 'max_accel', slider.val), root.dismiss())
                else: (app.set_config('printer', 'max_accel', slider.val), root.dismiss())

<SpeedPopup@BasePopup>:
    size_hint: 0.95, 0.4
    title: "Set Speed Factor"
    FloatLayout:
        UltraSlider:
            val: root.val
            buttons: [[100,0,"no multiplier",None]]
            val_min: 10
            val_max: 500
            unit: "%"
            roundto: 0
            id: slider
            width: root.width
            pos_hint: {'center_x':0.5, 'y':0.35}
        Btn_P_Cancel:
            id: btn_cancel
            width: root.width/2
            pos: root.pos
            on_release: root.dismiss()
        Btn_P_Confirm:
            enabled: slider.changed
            width: root.width/2
            pos: root.center_x, root.y
            on_release: app.send_speed(slider.val), root.dismiss()

<FlowPopup@BasePopup>:
    size_hint: 0.95, 0.4
    title: "Set Material Flow"
    FloatLayout:
        UltraSlider:
            val: root.val
            buttons: [[100,0,"no multiplier",None]]
            val_min: 90
            val_max: 110
            unit: "%"
            roundto: 1
            id: slider
            width: root.width
            pos_hint: {'center_x':0.5, 'y':0.35}
        Btn_P_Cancel:
            id: btn_cancel
            width: root.width/2
            pos: root.pos
            on_release: root.dismiss()
        Btn_P_Confirm:
            enabled: slider.changed
            width: root.width/2
            pos: root.center_x, root.y
            on_release: app.send_flow(slider.val), root.dismiss()

<FanPopup@BasePopup>:
    size_hint: 0.95, 0.4
    title: "Set Part Cooling"
    FloatLayout:
        UltraSlider:
            val: root.val
            buttons: [[0,0,"Off",None]]
            val_min: 0
            val_max: 100
            unit: "%"
            roundto: 0
            id: slider
            width: root.width
            pos_hint: {'center_x':0.5, 'y':0.35}
        Btn_P_Cancel:
            id: btn_cancel
            width: root.width/2
            pos: root.pos
            on_release: root.dismiss()
        Btn_P_Confirm:
            enabled: slider.changed
            width: root.width/2
            pos: root.center_x, root.y
            on_release: app.send_fan(slider.val), root.dismiss()

<BedTempPopup@BasePopup>:
    size_hint: 0.95, 0.4
    title: "Set Buildplate Temperature"
    FloatLayout:
        BedTempSlider:
            id: slider
            val: root.val['B'][0]
            width: root.width
            pos_hint: {'center_x':0.5, 'y':0.35}
        Btn_P_Cancel:
            id: btn_cancel
            width: root.width/2
            pos: root.pos
            on_release: root.dismiss()
        Btn_P_Confirm:
            enabled: slider.changed
            width: root.width/2
            pos: root.center_x, root.y
            on_release: app.send_temp(slider.val, "B"), root.dismiss()

<ExtTempPopup@BasePopup>:
    size_hint: 0.95, 0.4
    title: "Set "+root.creator.heater_id+" Temperature"
    FloatLayout:
        ExtTempSlider:
            val: root.val[root.creator.heater_id][0]
            id: slider
            width: root.width
            pos_hint: {'center_x':0.5, 'y':0.35}
        Btn_P_Cancel:
            id: btn_cancel
            width: root.width/2
            pos: root.pos
            on_release: root.dismiss()
        Btn_P_Confirm:
            enabled: slider.changed
            width: root.width/2
            pos: root.center_x, root.y
            on_release: app.send_temp(slider.val, root.creator.heater_id); root.dismiss()

# Not used, this is for when klipper gets temperature offsets
# <ExtTempOffsetPopup@BasePopup>:
#     size_hint: 0.95, 0.4
#     title: "Set "+root.creator.heater_id+" Temperature"
#     FloatLayout:
#         ExtTempOffsetSlider:
#             val: root.val[root.creator.heater_id][0]
#             id: slider
#             width: root.width
#             pos_hint: {'center_x':0.5, 'y':0.35}
#         Btn_P_Cancel:
#             id: btn_cancel
#             width: root.width/2
#             pos: root.pos
#             on_release: root.dismiss()
#         Btn_P_Confirm:
#             title: "Set Offset" if slider.offset != 0 else "Set Temperature"
#             width: root.width/2
#             pos: root.center_x, root.y
#             on_release: app.send_temp(slider.val, root.creator.heater_id); root.dismiss()

<FilamentChooserPopup@BasePopup>:
    size_hint: 0.95, 0.44
    title: "Which Material are you loading?"
    FloatLayout:
    #TODO everything

        Btn_P_Cancel:
            id: btn_cancel
            width: root.width/2
            pos: root.pos
            on_release: root.dismiss()
        Btn_P_Confirm:
            enabled: True
            title: "Start Loading"
            width: root.width/2
            pos: root.center_x, root.y
            on_release: app.send_temp(slider.val, root.creator.heater_id); root.dismiss()

<XyField>:
    mm: [0, 0, 0]
    px: [0, 0]
    canvas.after:
        Color:
            rgba: p.button_outline
        Line:
            width: 1
            rounded_rectangle: (self.x, self.y, self.width, self.height, p.radius)
        Color:
            rgba: p.button_outline if self.pressed else (0,0,0,0)
        Line:
            width: 1
            points: self.x, self.px[1],   self.right, self.px[1]
        Line:
            width: 1
            points: self.px[0], self.y,   self.px[0], self.top
        Color:
            rgba: (1,1,1,1) if self.enabled else p.button_disabled
        Ellipse:
            pos: self.px[0] - self.point_radius, self.px[1] - self.point_radius
            size: (self.point_radius*2, self.point_radius*2)
    Label:
        text: "X:{:.0f} Y:{:.0f} Z:{:.0f}".format(root.mm[0], root.mm[1], root.mm[2])
        size_hint: None, None
        size: self.texture_size
        pos: root.x + 7, root.y + 4
        font_size: p.normal_font
        color: p.nozzle


# FILE  ########################################################################

<FileTab@TabbedPanelItem>:
    background_down: ''
    background_normal: p.kgui_dir+'/Logos/Black.png'
    background_color: (0,0,0,0)
    canvas:
        Color:
            rgba: p.background if self.state == 'down' else (0,0,0,0)
        RoundedRectangle:
            radius: (0, 0, p.popup_radius, p.popup_radius)
            size: p.screen_width/3, p.tab_height
            pos: p.screen_width/3, 0
        Rectangle:
            size: p.tab_height/2, p.tab_height/2
            pos: p.screen_width/3 - p.tab_height/2, p.tab_height/2
        Rectangle:
            size: p.tab_height/2, p.tab_height/2
            pos: p.screen_width*2/3, p.tab_height/2
        Color:
            rgba: (0,0,0,1) if self.state == 'down' else (0,0,0,0)
        RoundedRectangle:
            size: p.tab_height/2, p.tab_height/2
            pos: p.screen_width/3 - p.tab_height/2, p.tab_height/2
            radius: (0, p.popup_radius, 0, 0)
        RoundedRectangle:
            size: p.tab_height/2, p.tab_height/2
            pos: p.screen_width*2/3, p.tab_height/2
            radius: (p.popup_radius, 0, 0, 0)
        RoundedRectangle:
            size: p.tab_height/2, p.tab_height/2
            pos: p.screen_width/3, p.tab_height/2
            radius: (p.popup_radius, 0, 0, 0)
        Color:
            rgba: (1,1,1,1) if self.state == 'down' else p.status_color
        Rectangle:
            source: p.kgui_dir+'/Logos/FilesIcon.png'
            size: 100,100
            pos: 250, 0
    FC:
        id: fc
        canvas.before:         
            Color:
                rgba: p.background
            RoundedRectangle:
                radius: (p.popup_radius,)
                size: self.size

<PrintPopup>:
    title: 'Print'
    title_size: p.large_font
    size_hint: 0.8, 0.3
    FloatLayout:
        Label:
            text: root.prompt
            halign: 'center'
            valign: 'middle'
            max_lines: 2
            size_hint: 0.9, 0.5
            pos_hint: {'center_x': 0.5, 'center_y': 0.5+0.2}
            text_size: self.size
            font_size: p.large_font
            color: p.light_gray
        Btn_P_Cancel:
            id: btn_cancel
            width: root.width/3
            pos: root.pos
            on_release: root.dismiss()
        BaseButton:
            id: btn_del
            canvas:
                Color:
                    rgba: p.divider
                Line:
                    points: self.x, self.y, self.x, self.top, self.right, self.top
            title: 'Delete'
            size: root.width/3, 70
            pos: btn_cancel.right, root.y
            on_release: root.delete()
        Btn_P_Confirm:
            title: 'Print'
            enabled: app.printer_objects_available
            width: root.width/3
            pos: btn_del.right, root.y
            on_release: root.confirm()

<DelPopup>:
    title: 'Delete'
    title_size: p.large_font
    size_hint: 0.8, 0.3
    FloatLayout:
        Label:
            text: root.creator.prompt
            halign: 'center'
            valign: 'middle'
            max_lines: 2
            size_hint: 0.9, 0.5
            pos_hint: {'center_x': 0.5, 'center_y': 0.5+0.2}
            text_size: self.size
            font_size: p.large_font
            color: p.light_gray
        Btn_P_Cancel:
            width: root.width/2
            pos: root.pos
            on_release: root.dismiss()
        Btn_P_Confirm:
            title: 'Delete'
            width: root.width/2
            enabled: True
            pos: root.center_x, root.y
            on_release: root.confirm()


# SETTING ########################################################################

<SettingTab@TabbedPanelItem>:
    background_down: '' 
    background_normal: p.kgui_dir+'/Logos/Black.png'
    background_color: (0,0,0,0)
    canvas:
        Color:
            rgba: p.background if self.state == 'down' else (0,0,0,0)
        RoundedRectangle:
            radius: (0, 0, p.popup_radius, p.popup_radius)
            size: p.screen_width/3, p.tab_height
            pos: p.screen_width*2/3,0
        Rectangle:
            size: p.tab_height/2, p.tab_height/2
            pos: p.screen_width*2/3 - p.tab_height/2, p.tab_height/2
        Color:
            rgba: (0,0,0,1) if self.state == 'down' else (0,0,0,0)
        RoundedRectangle:
            size: p.tab_height/2, p.tab_height/2
            pos: p.screen_width*2/3 - p.tab_height/2, p.tab_height/2
            radius: (0, p.popup_radius, 0, 0)
        Color:
            rgba: (1,1,1,1) if self.state == 'down' else p.status_color
        Rectangle:
            source: p.kgui_dir+'/Logos/SettingsIcon.png'
            size: 100, 100
            pos: 450, 0

    ScreenManager:
        name: 'SettingScreenManager'
        transition: screenmanager.NoTransition()
        SettingScreen:
        WifiScreen:

<SettingScreen@Screen>:
    name: 'SettingScreen'
    ScrollView:
        canvas.before:
            Color:
                rgba: p.background
            RoundedRectangle:
                radius: (p.popup_radius, p.popup_radius, 0, p.popup_radius)
                pos: self.pos
                size: self.size
        BoxLayout:
            orientation:'vertical'
            height: self.minimum_height
            pos: 0, root.height - self.height
            size_hint_y: None

            SI_Switch:
                left_title: "Light"
            SI_Switch:
                left_title: "Calibrate for every printjob"
            SetItem:
                left_title: "Max. printhead Acceleration"
                right_title: str(app.acceleration)+"mm/s²"
                on_release: Factory.AccPopup(write=True, val=app.acceleration).open()
            SetItem:
                left_title: "Pressure Advance"
                right_title: "{:4.3f}s".format(app.pressure_advance)
                on_release: Factory.PressureAdvancePopup(write=True, val=app.acceleration).open()
            SI_Wifi:
                left_title: "Wifi"
            SetItem:
                left_title: "Shutdown..."
                on_release: Factory.PowerPopup().open()

<WifiScreen>:
    name: 'WifiScreen'
    FloatLayout:
        id: float
        canvas.before:
            Color:
                rgba: p.background
            RoundedRectangle:
                radius: (p.popup_radius, p.popup_radius, 0, p.popup_radius)
                pos: self.pos
                size: self.size
        RectangleButton:
            id: btn
            #size_hint: 1, 0.1
            size: 150, 110
            pos_hint: {'x':0, 'top':1}
            #: set q 26
            canvas.before:
                Color:
                    rgba: 1,1,1,1
                Triangle:
                    points: btn.center_x-q, btn.center_y,   btn.center_x, btn.center_y-q,   btn.center_x, btn.center_y+q
            on_release:
                #root.manager.transition.direction = 'right'
                root.manager.current = 'SettingScreen'
        Label:
            text: "Wifi"
            font_size: p.large_font
            text_size: self.size
            size_hint: 1, 0.12
            pos_hint: {'x':0, 'top':1}
            valign: 'middle'
            halign: 'center' 
        ScrollView:
            size_hint: 1, 1-0.12
            pos_hint: {'x':0, 'y':0}
            do_scroll_x: False
            BoxLayout:
                id: wifi_box
                orientation: 'vertical'
                height: self.minimum_height
                size_hint_y: None    

<SetItem>:
    size_hint_y: None
    height: 110
    width: p.screen_width
    left_title: ""
    right_title: ""
    Label:
        id: left_label
        text: root.left_title
        font_size: p.normal_font
        text_size: self.size
        size: root.size
        valign: 'middle'
        pos: root.pos
        padding_x: p.padding
    Label:
        id: right_label
        text: root.right_title
        font_size: p.normal_font
        text_size: self.size
        color: p.medium_light_gray
        size: 250, root.height
        size_hint: None, None
        valign: 'middle'
        halign: 'right'
        y: root.y
        right: p.screen_width
        padding_x: p.padding
    Divider:
        y: root.y

<Divider@Widget>:
    size_hint: None, None
    height: 1
    width: p.screen_width - 2*p.small_padding
    x: p.small_padding
    canvas:
        Color:
            rgba: p.divider
        Rectangle:
            pos: self.pos
            size: self.width, 1

<SI_Switch@SetItem>:
    enabled: False
    Switch:
        id: knopf
        size_hint: None, None
        pos_hint: {'center_y': 0.5}
        right: p.screen_width-p.padding +p.small_padding #to increase touch area

<SI_WifiNetwork>:
    Label:
        text: root.network['ssid']
        font_size: p.normal_font
        text_size: self.size
        color: p.light_gray
        size: root.width, root.height
        size_hint: None, None
        valign: 'middle'
        halign: 'right'
        y: root.y
        right: p.screen_width
        padding_x: p.padding
    Label:
        text: str(root.network['signal'])
        font_size: p.normal_font
        padding_x: p.padding
        width: self.texture_size[0]
        height: root.height
        size_hint: None, None
        color: root.get_color()
        pos: root.pos

<PasswordPopup>:
    txt_input: pwd_input
    FloatLayout:
        Label:
            text: 'Password'
            font_size: p.normal_font
            size: self.texture_size
            size_hint: None, None
            pos_hint: {'x': 0.1, 'y': 0.75}
        TextInput:
            id: pwd_input
            multiline: False
            password: True
            height: self.minimum_height
            size_hint: 0.7, None
            pos_hint: {'x': 0.1, 'center_y': 0.63}
        RectangleButton:
            on_press: 
                if self.state == 'down': pwd_input.password = False
                elif self.state == 'normal': pwd_input.password = True
            on_release:
                pwd_input.focus = True
            id: btn_s
            height: pwd_input.height-1
            size_hint: 0.1, None
            pos_hint: {'x': 0.81, 'center_y': 0.63}
            Label:
                size: btn_s.size
                pos: btn_s.pos
                text_size: self.size
                text: "show"
                font_size: p.extra_small_font
                halign: 'center'
                valign: 'middle'
        Btn_P_Cancel:
            width: root.width/2
            pos: root.pos
            on_release: root.dismiss()
        Btn_P_Confirm:
            enabled: len(pwd_input.text) > 3
            width: root.width/2
            pos: root.center_x, root.y
            on_release: root.confirm()

<ConnectionPopup>:
    title: self.network['ssid']
    size_hint: 0.65, 0.4
    FloatLayout:
        RectangleButton:
            id: btn_toggle_connect
            title: 'Disconnect' if root.connected else 'Connect'
            size_hint: 0.7, None
            height: 80
            pos_hint: {'center_x': 0.5, 'top': 1}
            on_release: root.toggle_connected()
        Divider:
            size_hint: None, None
            size: btn_toggle_connect.width, 1
            pos: btn_toggle_connect.pos
        RectangleButton:
            id: btn_delete
            title: 'Delete connection'
            size: btn_toggle_connect.size
            x: btn_toggle_connect.x
            top: btn_toggle_connect.y
            on_release: root.delete()
        Btn_P_Cancel:
            single: True
            width: root.width
            pos: root.pos
            on_release: root.dismiss()

<PowerPopup@BasePopup>:
    title: "Shutdown"
    title_size: p.large_font
    size_hint: 0.65, 0.5
    FloatLayout:
        RectangleButton:
            id: btn_poweroff
            title: "Shutdown"
            size_hint: 0.7, None
            height: 90
            pos_hint: {'center_x': 0.5, 'y': 0.18}
            on_release: app.poweroff()
        Divider:
            size_hint: None, None
            size: btn_poweroff.width, 1
            pos: btn_reboot.pos
        RectangleButton:
            id: btn_reboot
            title: "Reboot"
            size: btn_poweroff.size
            pos: btn_poweroff.x, btn_poweroff.top
            on_release: app.reboot()
        Divider:
            size_hint: None, None
            size: btn_poweroff.width, 1
            pos: btn_restart_klipper.pos
        RectangleButton:
            id: btn_restart_klipper
            title: "Restart Klipper"
            size: btn_poweroff.size
            pos: btn_poweroff.x, btn_reboot.top
            on_release: app.restart_klipper()
        Divider:
            size_hint: None, None
            size: btn_poweroff.width, 1
            pos: btn_quit.pos
        RectangleButton:
            id: btn_quit
            title: "Quit to tty"
            size: btn_poweroff.size
            pos: btn_poweroff.x, btn_restart_klipper.top
            on_release: app.quit()
        Btn_P_Cancel:
            single: True
            width: root.width
            pos: root.pos
            on_release: root.dismiss()

<Background@Widget>:
    canvas.before:
        Color:
            rgba: p.background
        RoundedRectangle:
            radius: (p.popup_radius,)
            pos: self.pos
            size: self.size

# Override style.kv Switch widget
<-Switch>:
    active_norm_pos: max(0., min(1., (int(self.active) + self.touch_distance / sp(move))))
    width: wdt - rad + Rad + 2*p.small_padding
    canvas:
        Color:
            rgba: p.button
        #: set wdt 60
        #: set rad 11
        #: set Rad 16
        #: set move wdt-2*rad
        RoundedRectangle:
            size: sp(wdt), sp(rad*2)
            pos: int(self.center_x - sp(wdt/2)), int(self.center_y - sp(rad))
            radius: (int(sp(rad)),)
        Color:
            rgba: (1,1,1,1) if self.active else p.medium_light_gray
        
        Ellipse:
            size: sp(Rad*2), sp(Rad*2)
            pos: int(self.center_x - sp(move/2+Rad)  + self.active_norm_pos * sp(move)), int(self.center_y - sp(Rad))
        
<-TabbedPanelStrip>:
    canvas:
        Color:
            rgba: (0, 0, 0, 1) # black colour of the strip behind all 3 tab buttons
        Rectangle:
            size: self.size
            pos: self.pos

<StripLayout>: #a child of Gridlayout which is used by tabbedpanel, this disables padding
    padding: (0,0,0,0)

